# apiVersion: batch/v1
# kind: Job
# metadata:
#   namespace: dev-gitea  # namespace where the pvc's exist
#   name: volume-migration-test
# spec:
#   completions: 1
#   parallelism: 1
#   backoffLimit: 3
#   template:
#     metadata:
#       name: volume-migration-test
#       labels:
#         name: volume-migration-test
#     spec:
#       restartPolicy: Never
#       containers:
#         - name: volume-migration-test
#           image: praqma/network-multitool
#           tty: true
#           command: [ "/bin/sh" ]
#           args: [ "-c", "cp -r -v /mnt/old /mnt/new" ]
#           volumeMounts:
#             - name: old-vol
#               mountPath: /mnt/old
#             - name: new-vol
#               mountPath: /mnt/new
#       volumes:
#         - name: old-vol
#           persistentVolumeClaim:
#             claimName: postgres-pvc # change to data source pvc
#         - name: new-vol
#           persistentVolumeClaim:
#             claimName: postgres-pvc-new # change to data target pvc

# ---
# kind: Deployment
# apiVersion: apps/v1
# metadata:
#   name: volume-migration-test-deployment
#   namespace: dev-gitea
#   labels:
#     app: volume-migration-test-deployment
# spec:
#   replicas: 1
#   selector:
#     matchLabels:
#       app: volume-migration-test-deployment
#   template:
#     metadata:
#       labels:
#         app: volume-migration-test-deployment
#     spec:
#       nodeSelector:
#         node-type: worker
#       containers:
#         - name: volume-migration-test-deployment
#           image: praqma/network-multitool
#           tty: true
#           volumeMounts:
#             - name: old-vol
#               mountPath: /mnt/old
#             - name: new-vol
#               mountPath: /mnt/new
#           resources:
#             requests:
#               cpu: "1m"
#               memory: "20Mi"
#             limits:
#               cpu: "10m"
#               memory: "20Mi"
#           securityContext:
#             runAsUser: 0
#             capabilities:
#               add: ["NET_ADMIN"]
#       volumes:
#         - name: old-vol
#           persistentVolumeClaim:
#             claimName: postgres-pvc # change to data source pvc
#         - name: new-vol
#           persistentVolumeClaim:
#             claimName: postgres-pvc-new # change to data target pvc
